# BROOD --- Closed-Loop Behavioral Surrogate Learning (Apis)

------------------------------------------------------------------------

## Overview

**Brood** is the closed-loop behavioral surrogate learning subsystem of
Apis.

Its purpose is to learn models that reproduce how a controlled physical
system behaves **when commanded**, using trajectory data generated by
Nuc.

Brood does **not** attempt to reconstruct controller internals,
replicate firmware logic, or learn motor-level control.\
Instead, Brood learns how the *entire closed-loop system* responds to
commands.

In Apis terms:

    Nuc → generates closed-loop behavioral datasets
    Brood → learns closed-loop behavioral surrogate models

These models enable simulation-driven training, evaluation, and planning
at the command interface level.

------------------------------------------------------------------------

## Relationship to Apis

Apis is built as a layered autonomy stack:

  -----------------------------------------------------------------------
  Layer                               Responsibility
  ----------------------------------- -----------------------------------
  Flight Controller                   Stabilizes hardware and drives
                                      actuators

  Closed-Loop Physical System         Controller + physics + actuators +
                                      estimator

  Nuc                                 Generates deterministic behavioral
                                      trajectories

  Brood                               Learns surrogate behavioral
                                      transition models

  Waggle+                             Embeds behavior into interactive
                                      simulation and autonomy pipelines
  -----------------------------------------------------------------------

Brood enables later Apis stages to operate without direct access to
controller internals or hardware.

------------------------------------------------------------------------

## Conceptual Framing

Brood should be understood as learning **closed-loop behavioral system
models**.

Brood models:

    (state_t, command_t) → state_{t+1}

Where the system implicitly includes:

-   Controller logic
-   Actuator dynamics
-   Physical system response
-   Estimator effects
-   Timing and latency characteristics

Brood is therefore learning **behavioral emulation**, not controller
reconstruction.

------------------------------------------------------------------------

## Why Brood Exists

Without Brood, learning systems would need to simultaneously learn:

• Task behavior\
• Vehicle stabilization\
• Motor-level actuation dynamics\
• Hardware constraints

This leads to:

• Massive sample complexity\
• Instability in RL or planning\
• Poor sim-to-real transfer\
• Safety risks

Brood enables learning at the **pilot command interface**, similar to
fly-by-wire aircraft.

------------------------------------------------------------------------

## Core Learning Objective

Primary conceptual target:

    (state_t, command_t) → state_{t+1}

Secondary optional targets (if useful for learning):

    (state, reference) → controller_output

But controller-output prediction is never the final objective.\
The final objective is **closed-loop behavioral rollout fidelity**.

------------------------------------------------------------------------

## Relationship to Nuc

Nuc guarantees:

• Deterministic timestep execution\
• Reproducible trajectory datasets\
• Known command timing semantics\
• Log-first behavioral ground truth

Brood assumes:

If Nuc produces sufficient behavioral coverage,\
Brood can learn stable surrogate behavioral models.

------------------------------------------------------------------------

## Learning Approach

Brood is intentionally:

• Offline\
• Supervised\
• Deterministic-data driven\
• Fully decoupled from runtime simulation

This allows:

• Fast experimentation\
• Reproducible training\
• Stable debugging\
• Clean dataset lineage

------------------------------------------------------------------------

## Why Offline Learning

Training is performed offline to:

• Avoid coupling training to simulation runtime\
• Allow large-scale dataset replay\
• Enable architecture iteration without environment rebuilds\
• Support deterministic evaluation

------------------------------------------------------------------------

## Model Classes

Brood may use:

• MLP transition models\
• Sequence / history window models\
• Recurrent or latent state models (if hidden controller state is
significant)

Model class selection is driven by **rollout stability**, not parameter
interpretability.

------------------------------------------------------------------------

## Hidden State Considerations

Real closed-loop systems often contain hidden internal state:

• PID integrator memory\
• Filter history\
• Mode state machines\
• Estimator internal state

Brood must detect and compensate via:

• History windows\
• Latent state models\
• Sequence prediction architectures

------------------------------------------------------------------------

## Success Criteria

Brood success is not defined by loss metrics alone.

Primary metrics:

• Closed-loop rollout stability\
• Command response timing fidelity\
• Constraint preservation\
• Multi-step trajectory realism\
• Dataset generalization across command regimes

------------------------------------------------------------------------

## Behavioral Fidelity Definition

A Brood model is successful when:

Given the same state and command sequence,\
it produces statistically equivalent trajectories to the real system.

------------------------------------------------------------------------

## Explicit Non-Goals

Brood does NOT:

• Learn flight controllers\
• Replace firmware control loops\
• Learn motor-level actuation\
• Perform RL training directly\
• Perform perception modeling

Brood learns **behavioral transition models**.

------------------------------------------------------------------------

## Failure Is Information

Training failures are expected and useful.

They reveal:

• Missing excitation coverage\
• Hidden internal dynamics\
• Dataset bias\
• Model capacity limitations\
• Non-Markov behavior

------------------------------------------------------------------------

## Data Contract

Brood expects datasets of form:

    (state_t, command_t, state_{t+1})

Optional extensions:

• history windows\
• environment metadata\
• runconfig context

------------------------------------------------------------------------

## Dataset Requirements

High-quality Brood training requires:

• Broad command excitation\
• Coverage of transition regimes\
• Controller saturation exposure\
• Transient dynamics coverage\
• Mode transition coverage

------------------------------------------------------------------------

## Determinism Assumption

Brood assumes deterministic or near-deterministic trajectory generation
from Nuc.

Stochastic modeling can be layered later if required.

------------------------------------------------------------------------

## Training Outputs

Brood produces:

• Transition models\
• Validation metrics\
• Rollout stability reports\
• Dataset coverage diagnostics

------------------------------------------------------------------------

## Brood → Downstream Systems

Brood models will be used by:

• Waggle --- controller-in-the-loop simulation scaffolding\
• Propolis --- physics-accurate robotics simulation\
• Scopa --- virtual sensor data generation\
• Proboscis --- perception-to-action autonomy pipelines

------------------------------------------------------------------------

## Philosophy

> Brood learns what behavior looks like from the outside.\
> It does not attempt to understand controller internals.\
> It models what learning systems actually need:\
> **predictable command → behavior transitions.**

------------------------------------------------------------------------

## Terminology

  Term                   Meaning
  ---------------------- ---------------------------------------------
  Controller             Stabilizes vehicle and drives actuators
  Closed-loop system     Controller + hardware + physics + estimator
  Closed-loop behavior   Observable command → state evolution
  Surrogate              Learned behavioral stand-in model

------------------------------------------------------------------------

## One-Line Summary

Brood learns surrogate models that reproduce closed-loop command-level
system behavior using deterministic trajectory datasets generated by
Nuc.
